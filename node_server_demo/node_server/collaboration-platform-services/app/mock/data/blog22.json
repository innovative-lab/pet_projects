{
  "blog_id": "blog_mock_22",
  "title": "Apache Load Balancing",
  "author": null,
  "content": "<p>This blog will guide you through the following, \n*   Enabling basic load balancing using Apache httpd web server\n*   Adding Stickiness to the load balancing\n*   Gaining control over Apache's load balancing policy</p>\n\n<h2>Pre-requisites: Apache HTTPD web server 2.4 must be installed.</h2>\n\n<h2>Step 1: Load the following modules in the httpd.conf file</h2>\n\n<p><code>&lt;span style=\"color: #0000ff;\"&gt;&lt;em&gt;LoadModule proxy_module modules/mod_proxy.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule proxy_balancer_module modules/mod_proxy_balancer.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule proxy_html_module modules/mod_proxy_html.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule proxy_http_module modules/mod_proxy_http.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule lbmethod_heartbeat_module modules/mod_lbmethod_heartbeat.so&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;LoadModule slotmem_shm_module modules/mod_slotmem_shm.so&lt;/em&gt;&lt;/span&gt;</code></p>\n\n<h2>Step 2: Following is the syntax to use the mod_proxy_balancer.</h2>\n\n<p><code>&lt;span style=\"color: #0000ff;\"&gt;&lt;em&gt;&lt;Proxy balancer://&lt;cluster_name&gt;&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;BalancerMember http://&lt;ip1&gt;:&lt;port1&gt;/&lt;module_name&gt;&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;BalancerMember http://&lt;ip1&gt;:&lt;port2&gt;/&lt;module_name&gt;&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;&lt;/Proxy&gt;&lt;/em&gt;&lt;/span&gt;</code> <code>&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPass /&lt;module_name&gt; balancer://&lt;cluster_name&gt;&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPassReverse /&lt;module_name&gt; balancer://&lt;cluster_name&gt;&lt;/em&gt;&lt;/span&gt;</code> <ip> - IP address of the member <port> - Port number of the member <module_name> - Module name (Optional) <cluster_name> - arbitrary name assigned to the cluster   Here is an example for the same. Notice that \n*   <module_name> is “jenkins”\n*   <cluster_name> is “mycluster”\n*   There are 2 Balancer members</p>\n\n<p><span style=\"color: #0000ff;\"><em><code>&lt;Proxy balancer://mycluster&gt;\nBalancerMember http://localhost:8081/jenkins\nBalancerMember http://localhost:8082/jenkins\n&lt;/Proxy&gt;</code></em></span> <code>&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPass /jenkins balancer://mycluster&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPassReverse /jenkins balancer://mycluster&lt;/em&gt;&lt;/span&gt;</code>  </p>\n\n<h2>Step 3: Optionally, we can add stickiness to the load balancing by modifying the configuration as shown below,</h2>\n\n<p><code>&lt;span style=\"color: #0000ff;\"&gt;&lt;em&gt;Header add Set-Cookie \"ROUTEID=.%{BALANCER_WORKER_ROUTE}e; path=/\" env=BALANCER_ROUTE_CHANGED&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;&lt;Proxy balancer://mycluster&gt;&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;BalancerMember http://localhost:8081/jenkins&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;BalancerMember http://localhost:8082/jenkins&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxySet stickysession=ROUTEID&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;&lt;/Proxy&gt;&lt;/em&gt;&lt;/span&gt;</code> <code>&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPass /jenkins balancer://mycluster&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPassReverse /jenkins balancer://mycluster/&lt;/em&gt;&lt;/span&gt;</code>  </p>\n\n<h2>Step 4: We can also specify the load balancing policy to be used by using the lbmethod as shown below,</h2>\n\n<p><code>&lt;span style=\"color: #0000ff;\"&gt;&lt;em&gt;Header add Set-Cookie \"ROUTEID=.%{BALANCER_WORKER_ROUTE}e; path=/\" env=BALANCER_ROUTE_CHANGED&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;&lt;Proxy balancer://mycluster&gt;&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;BalancerMember http://localhost:8081/jenkins&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;BalancerMember http://localhost:8082/jenkins&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxySet lbmethod=bybusyness&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxySet stickysession=ROUTEID&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;&lt;/Proxy&gt;&lt;/em&gt;&lt;/span&gt;</code> <code>&lt;span style=\"color: #0000ff;\"&gt;&lt;em&gt;ProxyPass /jenkins balancer://mycluster&lt;/em&gt;&lt;/span&gt;\n&lt;span style=\"color: #0000ff;\"&gt; &lt;em&gt;ProxyPassReverse /jenkins balancer://mycluster/&lt;/em&gt;&lt;/span&gt;</code> The valid values for lbmethod are, \n*   byrequests - to perform weighted request counting\n*   bytraffic - to perform weighted traffic byte count balancing\n*   bybusyness - to perform pending request balancing\n*   heartbeat - uses the services of mod_heartmonitor to balance between origin servers that are providing heartbeat info via the mod_heartbeat module  </p>\n",
  "status": "PUBLISHED",
  "viewed_by": [],
  "tags": ["apache", "http", "infra"],
  "liked_by": [],
  "comments": [],
  "dateOfPublishing": "2016-06-17T16:25:24.353Z"
}