{
  "blog_id": "blog_mock_25",
  "title": "How to set-up Multi-DC Cassandra cluster",
  "author": null,
  "content": "<h2>Overview Cassandra is fault tolerant, distributed and Columnar (Key/Value) NoSQL database that supports linear scalability and capability to store and process massive amount of data. One of the differentiating factors of Cassandra is its active - active multi DC setup and configurable consistency. Since NoSQL is eventually consistent database and supports 'AP' of 'CAP' theorem, it offers tunable consistency at query level. In Cassandra context, architects trade-off between performance and consistency because higher consistency requirements have severe performance implications.</h2>\n\n<p><em>It's recommended that you study below posts before attempting to setup multi-DC Cassandra Cluster:</em> \n*   <em>Cassandra - SQL and Beyond</em>\n*   <em>Setup Cassandra in 15 minutes - step by step guide</em> Prerequisite:</p>\n\n<ol>\n<li>Cassandra Cluster is successfully setup on 2 different data centers or cloud service providers or zones. The data centers can be simulated using IP addresses in <strong>cassandra-topology.properties</strong> file.</li>\n<li>For multi-dc setup, ensure that communication ports 7000, 9160 and 9042 are configured to be open on the Public IP of each DC's firewall for communication the link <a href=\"http://www.datastax.com/documentation/cassandra/1.2/cassandra/security/secureFireWall_r.html?scroll=reference_ds_g53_svs_fk\">http://www.datastax.com/documentation/cassandra/1.2/cassandra/security/secureFireWall_r.html?scroll=reference_ds_g53_svs_fk</a></li>\n</ol>\n\n<h2><strong>Cassandra Multi-DC Cluster Setup</strong> Before setting up Cassandra cluster in Multi-DC configuration, one needs to understand 2 important architectural concepts a) Gossip b) Snitch a) Gossip is a peer - peer communication protocol that enables nodes to discover each other by exchanging state information. Gossip process runs every second and exchange state information with up to three other nodes in cluster. For more information, read the documentation available at </h2>\n\n<p><a href=\"http://www.datastax.com/documentation/cassandra/1.2/cassandra/architecture/architectureGossipAbout_c.html\" title=\"Gossip Protocol\">Gossip</a> b) Snitch is a way (configuration) of mapping a Cassandra node to its physical location in the Network. Snitch helps in determining the location of a Cassandra Node relative to other cluster nodes to efficiently route the requests. Based on the cluster and data center setup, one of the 7 types of Snitch configuration can be chosen. For more information, study the documentation at <a href=\"http://www.datastax.com/documentation/cassandra/1.2/cassandra/architecture/architectureSnitchesAbout_c.html\" title=\"Snitch configuration\">Snitch</a>. Now let's look at setting up Cassandra Cluster in Multi-DC configuration. The setup will use 'PropertyFileSnitch' configuration: <span style=\"font-family: 'courier new', courier;\"><span style=\"font-family: 'arial black', 'avant garde';\">1.</span></span><em><span style=\"font-family: 'courier new', courier;\"> PropertyFileSnitch</span></em> needs configuration to identify location of Cassandra nodes by Rack and Data Center. This configuration is defined in <span style=\"font-family: 'courier new', courier;\"><em>cassandra-topology.properties, </em><span style=\"font-family: georgia, palatino;\">which should be created in same folder as <em><span style=\"font-family: 'courier new', courier;\">cassandra.yaml</span></em> file. The default location of 'RPM' based installation is '<span style=\"font-family: 'courier new', courier;\"><em>/etc/dse/cassandra/</em></span>'. Below is the sample file.</span></span></p>\n\n<p style=\"padding-left: 60px;\">\n  <span style=\"font-family: 'courier new', courier;\">#DC1 definition (DC1 and RAC1 are logical names to define network location of nodes)</span> <span style=\"font-family: 'courier new', courier;\"><public IP of node1>=DC1:RAC1</span> <span style=\"font-family: 'courier new', courier;\"><public IP of node2>=DC2:RAC1</span>\n</p>\n\n<p style=\"padding-left: 60px;\">\n  #<span style=\"font-family: 'courier new', courier;\">DC2 definition</span>\n</p>\n\n<p style=\"padding-left: 60px;\">\n  <span style=\"font-family: 'courier new', courier;\"><public IP of node3> =DC2:RAC1</span> <span style=\"font-family: 'courier new', courier;\"><public IP of node4>=DC2:RAC1 </span>\n</p>\n\n<p style=\"padding-left: 60px;\">\n  <span style=\"font-family: 'courier new', courier;\"># default for unknown nodes</span> <span style=\"font-family: 'courier new', courier;\">default=DC1:RAC1</span>\n</p>\n\n<p style=\"padding-left: 30px;\">\n  Note: IP addresses should be same as specified in '<span style=\"font-family: 'courier new', courier;\">broadcast_address</span>' property of '<span style=\"font-family: 'courier new', courier;\">cassandra.yaml</span>'\n</p>\n\n<p><span style=\"font-family: 'arial black', 'avant garde';\">2. <span style=\"font-family: georgia, palatino;\">Configure '<span style=\"font-family: 'courier new', courier;\">cassandra.yaml</span>' for 'Multi-DC cluster setup. Configure attribute listed below:</span></span> \n*   <span style=\"font-family: 'courier new', courier;\">cluster_name</span> - Should be same on all the nodes\n*   <span style=\"font-family: 'courier new', courier;\">seeds</span> – public IP address of the seed nodes\n*   <span style=\"font-family: 'courier new', courier;\">listen_address</span> – In general set to local ip address of the node\n*   <span style=\"font-family: 'courier new', courier;\">rpc_address</span> – should be 0.0.0.0\n*   <span style=\"font-family: 'courier new', courier;\">broadcast_address</span> – public ip address of the node\n*   <span style=\"font-family: 'courier new', courier;\">endpoint_snitch</span> –Use <span style=\"font-family: georgia, palatino;\">PropertyFileSnitch</span></p>\n\n<p><span style=\"font-family: 'arial black', 'avant garde';\"><strong>3. </strong><span style=\"font-family: georgia, palatino;\">Start cluster</span></span> \n*   Start the seed nodes one at a time, in the sequence as specified in <span style=\"font-family: 'courier new', courier;\">cassandra.yaml</span> file and then start the rest of the nodes using the following commands.</p>\n\n<p style=\"padding-left: 60px;\">\n  <span style=\"font-family: 'courier new', courier;\">$ sudo service dse start</span>\n</p>\n\n<p style=\"padding-left: 60px;\">\n  <span style=\"font-family: 'courier new', courier;\">$ sudo service datastax-agent start</span>\n</p>\n\n<ul>\n<li>To ensure that the cluster is up and running, run below command</li>\n</ul>\n\n<p style=\"padding-left: 60px;\">\n  <span style=\"font-family: 'courier new', courier;\">$ nodetool status</span>\n</p>\n",
  "status": "PUBLISHED",
  "viewed_by": [],
  "tags": ["cassandra", "nosql", "cluster"],
  "liked_by": [],
  "comments": [],
  "dateOfPublishing": "2016-06-17T16:25:24.353Z"
}